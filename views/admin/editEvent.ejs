<!DOCTYPE html>
<html lang="en">
  <head>
    <%- include('../partials/header.ejs') %>
  </head>
  <body>
    <% const toDatetimeLocal = (date) => { if (!date) return ''; const d = new
    Date(date); const pad = (n) => String(n).padStart(2, '0'); return (
    d.getFullYear() + '-' + pad(d.getMonth() + 1) + '-' + pad(d.getDate()) + 'T'
    + pad(d.getHours()) + ':' + pad(d.getMinutes()) ); }; %>
    <div class="main">
      <%- include('../partials/navbar.ejs') %>

      <div class="add-edit-container">
        <h1 class="headingg margin">Edit Event</h1>

        <form
          class="add-edit-form"
          action="/admin/edit-event/<%= locals.event._id %>"
          method="post"
        >
          <label>
            <p>ğŸ“ Event Title</p>
            <input
              type="text"
              name="title"
              value="<%= locals.event.title %>"
              minlength="20"
              required
            />
          </label>

          <label>
            <p>ğŸ“„ Short Description</p>
            <textarea name="shortDescription" minlength="100" required>
<%= locals.event.shortDescription %></textarea
            >
          </label>

          <label>
            <p>ğŸ“‹ Session Overview</p>
            <textarea name="description" minlength="100" required>
<%= locals.event.description %></textarea
            >
          </label>

          <label>
            <p>ğŸ¢ Organiser's Name</p>
            <input
              type="text"
              name="organiser"
              value="<%= locals.event.organiser %>"
              required
            />
          </label>

          <label>
            <p>ğŸ“ Venue</p>
            <input
              type="text"
              name="venue"
              value="<%= locals.event.venue %>"
              required
            />
          </label>

          <label>
            <p>ğŸ‘¥ Venue Capacity</p>
            <input
              type="number"
              name="capacity"
              value="<%= locals.event.capacity %>"
              min="1"
              max="100000"
              required
            />
          </label>

          <label>
            <p>ğŸ• Start Date and Time</p>
            <input
              type="datetime-local"
              name="startTime"
              id="startDate"
              value="<%= toDatetimeLocal(locals.event.startTime) %>"
              required
            />
          </label>

          <div class="crack">
            <label class="buzz">â° Registration Deadline</label>

            <div class="checkk">
              <input type="checkbox" id="deadlineCheck" />
              <label for="deadlineCheck">Same as start date and time</label>
            </div>

            <input
              type="datetime-local"
              name="deadline"
              id="deadline"
              value="<%= toDatetimeLocal(locals.event.deadline) %>"
              data-start="<%= toDatetimeLocal(locals.event.startTime) %>"
              required
            />

            <p class="link add-edit-size">
              Last date and time for registration
            </p>
          </div>

          <label>
            <p>ğŸ•‘ End Date and Time</p>
            <input
              type="datetime-local"
              name="endTime"
              value="<%= toDatetimeLocal(locals.event.endTime) %>"
              required
            />
          </label>

          <div class="crack">
            <label class="buzz">ğŸ“‹ Publisher's Name</label>

            <div class="checkk">
              <input type="checkbox" id="authorCheck" />
              <label for="authorCheck">Same as admin's name</label>
            </div>

            <input
              type="text"
              name="author"
              id="author"
              value="<%= locals.event.author ?? 'Dr Lipika Das' %>"
              data-author="<%= locals.user.fullName %>"
              maxlength="32"
              required
            />
          </div>

          <label>
            <p>ğŸ“‹ Publisher's Position</p>
            <input
              type="text"
              name="position"
              value="<%= locals.event.position ?? 'Chair, HRDC' %>"
              maxlength="32"
              required
            />
          </label>

          <button class="add-edit-button" type="submit">âœ¨ Make Changes</button>
        </form>
      </div>
    </div>

    <%- include('../partials/footer.ejs') %>

    <script>
      const deadlineCheck = document.getElementById("deadlineCheck");
      const startTime = document.getElementById("startDate");
      const deadline = document.getElementById("deadline");

      const author = document.getElementById("author");
      const authorCheck = document.getElementById("authorCheck");
      const authorName = author.dataset.author;

      const finalName = authorName
        .split(" ")
        .map((w) => w[0].toUpperCase() + w.slice(1))
        .join(" ");

      function syncDeadline(e) {
        deadline.value = e.target.value;
      }

      deadlineCheck.addEventListener("change", (e) => {
        if (e.target.checked) {
          deadline.readOnly = true;
          deadline.value = startTime.value;
          startTime.addEventListener("change", syncDeadline);
        } else {
          deadline.readOnly = false;
          startTime.removeEventListener("change", syncDeadline);
          deadline.value = deadline.dataset.start;
        }
      });

      authorCheck.addEventListener("change", (e) => {
        if (e.target.checked) {
          author.readOnly = true;
          author.value = finalName;
          author.style.backgroundColor = "#eee";
          author.style.color = "#555";
        } else {
          author.readOnly = false;
          author.value = "";
          author.style.backgroundColor = "unset";
          author.style.color = "unset";
        }
      });
    </script>
  </body>
</html>
