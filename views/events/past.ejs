<!DOCTYPE html>
<html lang="en">
  <head>
    <%- include('../partials/header.ejs') %>
  </head>
  <body>
    <div class="main">
      <%- include('../partials/navbar.ejs') %>
      <div class="heading-div">
        <h1 class="heading">Past Events</h1>
        <form action="/events/history" method="get" class="sort-by-div">
          <label>
           <span>Sort by:&nbsp;</span>
            <select class="selected" onchange="this.form.submit()" name="sort">
              <option value="recent" <%= locals.select=== 'recent' ? 'selected' : '' %> >recent</option>
              <option value="oldest"  <%= locals.select=== 'oldest' ? 'selected' : '' %> >oldest</option>
              <option value="upload-time" <%= locals.select=== 'upload-time' ? 'selected' : '' %> >upload time</option>
            </select>
          </label>
        </form>
      </div>
      <div class="event-list-div">
        <% locals.events.forEach(event=> { %> <% const startDate=new
        Date(event.startTime); const endDate=new Date(event.endTime); pad2=(n)=>
        String(n).padStart(2, '0'); const to12Hour = (d) => { const h24 =
        d.getHours(); const ap = h24 < 12 ? 'AM' : 'PM' ; const h12=(h24 % 12)
        || 12; return `${h12}:${pad2(d.getMinutes())} ${ap}`; }; const
        months=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
        const startTimeText=to12Hour(startDate); const
        endTimeText=to12Hour(endDate); const
        startDateText=`${pad2(startDate.getDate())}
        ${months[startDate.getMonth()]}`; %>

        <div class="event-div">
          <div class="event-time-div">
            <div class="event-time-internal-div">
              <div class="event-start-time"><%= startTimeText %></div>
              <div class="event-start-date"><%=startDateText%></div>
              <div class="event-end-time"><%= endTimeText %></div>
              <img class="dotted-line" src="/images/dotted-line.png" />
            </div>
          </div>
          <div class="event-desc-div">
            <div class="event-title"><%= event.title %></div>
            <div class="event-short-description">
              <%= event.shortDescription %>
            </div>
          </div>
        </div>
        <% }) %>
      </div>
    </div>
    <%- include('../partials/footer.ejs') %>
  </body>
</html>
