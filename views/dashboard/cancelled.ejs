<!DOCTYPE html>
<html lang="en">
  <head>
    <%- include('../partials/header.ejs') %>
  </head>
  <body>
    <div class="main">
      <%- include('../partials/navbar.ejs') %>

     
      <div class="heading-div">
        <h1 class="heading">My Space</h1>
        <form action="/dashboard/cancelled" method="get" class="sort-by-div">
          <label>
           <span>Sort by:&nbsp;</span>
             <select class="selected" name="sort"  onchange="this.form.submit()">
              <option value="recent" <%= locals.select=== 'recent' ? 'selected' : '' %> >recent</option>
              <option value="oldest"  <%= locals.select=== 'oldest' ? 'selected' : '' %> >oldest</option> 
            </select>
          </label>
        </form>
      </div>

      
        <div class="sub-nav-div">
        <a href="/dashboard/registered" class="sub-nav-button <%= locals.uri ==='REGISTERED'?'registered':'' %>">Registered</a>
        <a href="/dashboard/cancelled" class="sub-nav-button <%= locals.uri ==='CANCELLED'?'cancelled':'' %>">Cancelled</a>
      </div>

            <% if(locals.cancelledEvents.length) { %>
      <div class="event-list-div">
        <% locals.cancelledEvents.forEach(event=> { %> 

              <div class="event-div">

        <a href="/events/<%= event.eventId._id %>" class="event-child-div">
          <div class="event-time-div">
            <div class="event-time-internal-div">
      <div class="event-start-time" data-utc="<%= event.eventId.startTime.toISOString() %>"></div>
<div class="event-start-date" data-utc="<%= event.eventId.startTime.toISOString() %>"></div>
<div class="event-end-time" data-utc="<%= event.eventId.endTime.toISOString() %>"></div>
              <img class="dotted-line" src="/images/dotted-line1.webp" />
            </div>
          </div>
          <div class="event-desc-div">
            <div class="event-title"><%= event.eventId.title %></div>
            <div class="event-short-description">
              <%= event.eventId.shortDescription %>
            </div>
          </div>
        </a>
        </div>
        <% }) %>
      </div>

       <% } else { %>
          <div class="message">ðŸ˜Š You have no cancelled events yet!</div>
    <% } %>
    </div>
    <%- include('../partials/footer.ejs') %>
    <script>
  const pad2 = n => String(n).padStart(2, '0');
  const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];

  document.querySelectorAll('[data-utc]').forEach(el => {
    const d = new Date(el.dataset.utc); // USER timezone

    if (el.classList.contains('event-start-time') ||
        el.classList.contains('event-end-time')) {
      const h24 = d.getHours();
      const ap = h24 < 12 ? 'AM' : 'PM';
      const h12 = (h24 % 12) || 12;
      el.textContent = `${h12}:${pad2(d.getMinutes())} ${ap}`;
    }

    if (el.classList.contains('event-start-date')) {
      el.textContent = `${pad2(d.getDate())} ${months[d.getMonth()]}`;
    }
  });
</script>

  </body>
</html>
